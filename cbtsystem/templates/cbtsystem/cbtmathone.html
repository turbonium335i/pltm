<!DOCTYPE html>
<html lang="en">

<head>
    <title>CBT Math 1</title>
    <!--    <link rel="shortcut icon" type="image/png"-->
    <!--          href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9Ii0xMS41IC0xMC4yMzE3NCAyMyAyMC40NjM0OCI+CiAgPHRpdGxlPlJlYWN0IExvZ288L3RpdGxlPgogIDxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSIyLjA1IiBmaWxsPSIjNjFkYWZiIi8+CiAgPGcgc3Ryb2tlPSIjNjFkYWZiIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIi8+CiAgICA8ZWxsaXBzZSByeD0iMTEiIHJ5PSI0LjIiIHRyYW5zZm9ybT0icm90YXRlKDYwKSIvPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIiB0cmFuc2Zvcm09InJvdGF0ZSgxMjApIi8+CiAgPC9nPgo8L3N2Zz4K">-->
    <!-- -->
    <link rel="shortcut icon" type="image/png" href="https://i.postimg.cc/sxXLWRys/logo-plativ2.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <script src="https://code.jquery.com/jquery-3.5.1.js"
            integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>


</head>

<style>
    .scrolly {
         height: 85vh;

        overflow-y: auto;
    }

    /* width */
    ::-webkit-scrollbar {
        width: 6px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
        background: #a9a9a9;
    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
        background: white;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

input[type='radio'] {
  height: 15px;
  width: 15px;
  vertical-align: middle;
}







</style>
<!--#f0ead6;-->

<body class="" style="background-color:white">
<nav class="navbar navbar-dark" style="background-color: rgba(55,53,53,255)">
    <div class="ms-2 d-inline btn-group" style="letter-spacing: 0px;" id="questionBox">
        <!--         for button in buttons -->
        <!--        <button type="button" class="btn btn-outline-dark btn-sm" > button </button>-->
        <!--          endfor -->

    </div>

</nav>
<hr class="bg-success m-0 p-0  " style="height:5px;" id="submitCheck">
<div class="mx-2 pt-2 mx-lg-4 mx-xl-5">
    {{ request.user.id|json_script:"user_id" }}
        <div class="d-flex justify-content-between pb-1">

            <span class="fw-bold"> Section 2: Math </span>
            <div>
                <!-- <span class="border border-dark rounded px-1 mb-1 me-1" onclick="fullscreen()" style="cursor: pointer;">
                    <i class="bi bi-window-fullscreen"></i> F11
                </span> -->
                <span class=" border border-dark rounded px-1 mb-1 text-center" onclick="timerFunction()"
                    style="cursor: pointer;">
                    <i class="bi bi-clock-history timerOn" id="timer"></i> Timer
                </span>

            </div>

        </div>
        <div id="demo" class="text-center fw-bold">00:00:00</div>
    <!--    <div class="fw-bold mb-1 mx-0">PASSAGE I</div>-->


        <div class="row pt-2" style="border-top: dotted gray;border-bottom: dotted gray;">
        <div class="col-sm-9  scrolly border-end border-none">
            <!--            <iframe-->
            <!--                    src="https://drive.google.com/file/d/14xUAfhLiG2AQR-jdNcjwT9ZYlA0ZaHZr/preview"-->
            <!--                    width="100%"-->
            <!--                    height="100%"-->
            <!--            ></iframe>-->
            <iframe
                    src="{{testPDF.pdfLink}}"
                    width="100%"
                    height="100%"
            ></iframe>


        </div>


            <div class="col-sm-3 scrolly mt-5 mt-sm-0 ps-sm-3 text-dark">
      <div class="d-flex justify-content-between  mb-2 fw-bold "
                        style="background-color:#D3D3D3; border-bottom: dotted gray;">
                        <div class="bg-dark text-light px-1" span id="questionNo"> </div>

                    </div>
            <form action="/action_page.php" class="d-inline" id="multiBox">

                  <input type="radio" id="A" name="fav_language" value="A">
                  <label for="A">A</label><br>
                  <input type="radio" id="B" name="fav_language" value="B">
                  <label for="B">B</label><br>
                  <input type="radio" id="C" name="fav_language" value="C">
                  <label for="C">C</label><br>
                  <input type="radio" id="D" name="fav_language" value="D">
                  <label for="D">D</label>
                <br>
            </form>
            <form class="d-none" id="inputBox">
                <label for="fname" class="fw-bold">Answer:</label>
                <br>
                <input type="text" id="fname" name="fname" autofocus maxlength="12"
                       style="text-align: center; color: blue; font-size: 1.25rem;width: 160px" autocomplete="off"><br><br>
            </form>
            <br>
            <!--            <button type="button" class="btn btn-outline-primary " id="saveBtn" onclick="saveFunction()">Save <i-->
            <!--                    class="bi bi-save"></i></button>-->

            <!--<button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#staticBackdrop">-->
            <!--    <i class="bi bi-calculator-fill"></i>-->
            <!--</button>-->
              <button type="button" class="btn btn-outline-danger" onclick="viewCal()">
                    <i class="bi bi-calculator-fill"></i>
                </button>

            <button type="button" class="btn btn-outline-secondary " id="saveBtn" onclick="saveFunction()">
                <i class="bi bi-eraser"></i></button>


            <button type="button" class="btn btn-outline-warning " id="flagBtn" onclick="flagFunction()"><i
                    class="bi bi-flag"></i></button>

            <br><br> <br><br>
                <button type="button" class="btn btn-primary rounded-pill" id="backBtn" onclick="prevFunction()"><i
                        class="bi bi-arrow-left-circle"></i>
                    Prev
                </button>
                <button type="button" class="btn btn-primary rounded-pill" id="nextBtn" onclick="nextFunction()">Next <i
                        class="bi bi-arrow-right-circle"></i></button>

            <!-- Button trigger modal -->


            <!-- Modal -->
            <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
                 aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header ">
                            <h5 class="modal-title" id="staticBackdropLabel">Graphing Calculator</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body ">
                            <div class="float-right">
                                <!--<div id="calculatorx" style="width: 750px; height: 500px;"></div>-->
                            </div>

                        </div>

                    </div>
                </div>
            </div>

            <div class="text-end">
                <br> <br> <br>
                <br> <br> <br> <br> <br>
                <!--     <a href="{% url 'index' %}" type="button" class="btn btn-outline-primary">  Home</a>-->
                <button type="button" class="btn btn-outline-dark" onclick="doneAnswers()" id="endSectionBtn"> &#10006;
                    End Section
                </button>


            </div>
            <br>

            <p style="line-height: 0.9;"><small class="text-danger">
                *Save at least one answer to skip to the next section.
            </small></p>

        </div>


    </div>

        <div class="d-flex justify-content-around my-5">
            <div id="calculatorx" style="width: 750px; height: 500px;"> </div>
        </div>
        <div class="float-right pb-5">
            <button type="button" class="btn btn-outline-dark float-end" onclick='topFunction()'>
                <i class="bi bi-arrow-up  "></i>
            </button>
        </div>
</div>


<script>

 var timeLeft = 2100000

 if (localStorage.getItem('mathOneApiTime') !== null) {
    console.log(`mathOneApiTime exists`);
    timeLeft = parseInt(localStorage.getItem('mathOneApiTime'))

} else {
    console.log(`mathOneApiTime not found`);
}


        var countDownDate = (Date.now() + timeLeft)
        var x = setInterval(function () {
            var now = new Date().getTime();
            var distance = countDownDate - now;
            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

            if (hours < 10) {
                hours = "0" + hours
            }
            if (minutes < 10) {
                minutes = "0" + minutes
            }
            if (seconds < 10) {
                seconds = "0" + seconds
            }

            document.getElementById("demo").innerHTML = hours + "h "
                + minutes + "m " + seconds + "s ";

            if (distance < 0) {
                clearInterval(x);
                document.getElementById("demo").innerHTML = "TIME UP";
            }

                        timeLeft -= 1000
            localStorage.setItem('timeLeft', JSON.stringify(timeLeft));
         localStorage.setItem('mathOneApiTime', JSON.stringify(timeLeft));
<!--            console.log(localStorage.getItem('timeLeft'))-->
        }, 1000);

        function timerFunction() {

            var timer = document.getElementById("timer");
            var demo = document.getElementById("demo");

            if (timer.classList.contains('timerOn')) {

                demo.style.display = "none";
                timer.classList.remove("timerOn");


            } else {
                demo.style.display = "block";
                timer.classList.add("timerOn");

            }



        }






</script>

    <script>
            function viewCal() {
                const element = document.getElementById("calculatorx");
                element.scrollIntoView();
            }

            function topFunction() {
                document.body.scrollTop = 0;
                document.documentElement.scrollTop = 0;
            }
    </script>

<script>

var subjectiveAnswers = [20, 21, 22]
var obj = {}
const user_id = JSON.parse(document.getElementById('user_id').textContent);
console.log("user_id", user_id)
var localAnswers = localStorage.getItem("mathOneApi");
console.log(localAnswers)
if (localAnswers !== null) {
var b = localAnswers.replace(/'/g, '"');
obj = JSON.parse(b);
console.log(obj);
}
    var inputBox = document.getElementById("inputBox");
    var doneList = obj
    var flagList = {   }
    var currentQuestion = 1;
    var lastQuestion = 1;
        var qCount = 23;
    var qArray = [];
    for (let i = 1; i < qCount; i++) {
        qArray.push({ [i]: '' })
    }
    var questionBox = document.getElementById("questionBox");
    for (let i = 1; i < qArray.length + 1; i++) {
        console.log(flagList[i])
                    if  (i === 1 && doneList[i] === '' ) {
            var qBtn = `
<button type="button" class="btn btn-light btn-sm notDone border-dark py-0 " id=b${i} onclick="btnFunction(${i})">${i}</button>`
        }
       else if (i === 1 && doneList[i] !== undefined ) {
            var qBtn = `
<button type="button" class="btn   btn-sm  btn-primary py-0  border-danger border-2"
id=b${i} onclick="btnFunction(${i})">${i}</button>`
        }
        else if (i === 1 && flagList[i] !== undefined) {
            var qBtn = `
<button type="button" class="btn btn-outline-dark btn-sm py-0  btn-warning  border-danger border-2"
id=b${i} onclick="btnFunction(${i})">${i}</button>`
        }
        else if (i === 1 && doneList[i] !== undefined && flagList[i] !== undefined) {
            var qBtn = `
<button type="button" class="btn btn-outline-dark btn-sm py-0 notDone border-danger border-2"
id=b${i} onclick="btnFunction(${i})">${i}</button>`
        }
        else if (doneList[i] === '') {
                        var qBtn = `
<button type="button" class="btn btn-light btn-sm notDone border-dark py-0 " id=b${i} onclick="btnFunction(${i})">${i}</button>`
        }
        else if (doneList[i] !== undefined) {
            var qBtn = `
<button type="button" class="btn  btn-primary btn-sm py-0 border-dark "
id=b${i} onclick="btnFunction(${i})">${i}</button>`
        }
        else if (flagList[i] !== undefined) {
            var qBtn = `
<button type="button" class="btn  btn-warning btn-sm  py-0 border-dark "
id=b${i} onclick="btnFunction(${i})">${i}</button>`
        }
        else {
            var qBtn = `
<button type="button" class="btn btn-light btn-sm notDone border-dark py-0 " id=b${i} onclick="btnFunction(${i})">${i}</button>`
        }
        questionBox.innerHTML += qBtn;
    }
    function nextFunction() {
        console.log('currentQuestion: ', currentQuestion)
        if (subjectiveAnswers.includes(currentQuestion)) {
            var formAnswer = document.getElementById('fname').value
            document.getElementById("inputBox").reset();
            console.log(doneList);
            if (formAnswer != "") {
                var clickedBtn = document.getElementById("b" + currentQuestion.toString());
                console.log(flagList);
                if (flagList.hasOwnProperty(currentQuestion.toString())) {
                    console.log("in flag function");
                    currentQuestion += 1;
                    btnFunction(currentQuestion);
                } else {
                    clickedBtn.classList.remove("btn-light", "btn-warning", "btn-dark");
                    clickedBtn.classList.add("btn-primary");
                    doneList[currentQuestion] = formAnswer
                    console.log(doneList);
                    localStorage.setItem("doneList", JSON.stringify(doneList));
                    $("#submitCheck")
                        .fadeOut(100)
                        .fadeIn(200)
                        .fadeOut(100)
                        .fadeIn(200)
                        .fadeOut(100)
                        .fadeIn(100);
                    currentQuestion += 1;
                    btnFunction(currentQuestion);
                }
            } else {
                currentQuestion += 1;
                btnFunction(currentQuestion);
            }
        }
        else {
            var checkRadio = document.querySelector('input[name="fav_language"]:checked');
            if (checkRadio != null) {
                var clickedBtn = document.getElementById("b" + currentQuestion.toString());
                console.log(flagList);
                if (flagList.hasOwnProperty(currentQuestion.toString())) {
                    console.log("in flag function");
                    currentQuestion += 1;
                    btnFunction(currentQuestion);
                } else {
                    clickedBtn.classList.remove("btn-light", "btn-warning", "btn-dark");
                    clickedBtn.classList.add("btn-primary");
                    doneList[currentQuestion] = checkRadio.id;
                    console.log(doneList);
                    localStorage.setItem("doneList", JSON.stringify(doneList));
                    $("#submitCheck")
                        .fadeOut(100)
                        .fadeIn(200)
                        .fadeOut(100)
                        .fadeIn(200)
                        .fadeOut(100)
                        .fadeIn(100);
                    currentQuestion += 1;
                    btnFunction(currentQuestion);
                }
            } else {
                currentQuestion += 1;
                btnFunction(currentQuestion);
            }
        }
    }
    function prevFunction() {
        currentQuestion -= 1;
        btnFunction(currentQuestion)
    }
    function btnFunction(id) {
        if (subjectiveAnswers.includes(id)) {
            multiBox.classList.remove("d-inline");
            multiBox.classList.add("d-none");
            inputBox.classList.remove("d-none");
            inputBox.classList.add("d-inline");
            try {
                if (doneList[id.toString()] != undefined) {
                    document.getElementById("fname").value = doneList[id.toString()];
                } else {
                    document.getElementById("fname").value = ""
                }
            } catch (err) {
                console.log('no subjective')
            }
        } else {
            multiBox.classList.add("d-inline");
            multiBox.classList.remove("d-none");
            inputBox.classList.add("d-none");
            inputBox.classList.remove("d-inline");
        }
        var lastClickedBtn = document.getElementById('b' + (lastQuestion.toString()));
        lastClickedBtn.classList.remove("border-danger", "border-2");
        lastClickedBtn.classList.add("border-dark");
        currentQuestion = id
        var clickedBtn = document.getElementById('b' + (id.toString()));
        clickedBtn.classList.remove("border-dark");
        clickedBtn.classList.add("border-danger", "border-2");
        document.getElementById('questionNo').innerHTML = id
        $("#questionNo").fadeOut(300).fadeIn(300)
        lastQuestion = currentQuestion
        try {
            document.getElementById(doneList[id.toString()]).checked = true;
        }
        catch (err) {
            try { document.getElementById(flagList[id.toString()]).checked = true; }
            catch (err) {
                console.log('radio empty')
                var checkRadio = document.querySelector('input[name="fav_language"]:checked');
                // console.log(document.querySelector('input[name="fav_language"]:checked'));
                if (checkRadio != null) {
                    document.querySelector('input[name="fav_language"]:checked').checked = false;
                }
            }
        }
    }
    function saveFunction() {
        var clickedBtn = document.getElementById('b' + (currentQuestion.toString()));
        clickedBtn.classList.remove("btn-primary");
        clickedBtn.classList.add("btn-light", "btn-warning", "notDone");
        delete doneList[currentQuestion];
        delete flagList[currentQuestion];
        if (subjectiveAnswers.includes(currentQuestion)) {
            document.getElementById("inputBox").reset();
        } else {
            var checkRadio = document.querySelector('input[name="fav_language"]:checked');
            checkRadio.checked = false;
        }
        console.log(doneList);
        localStorage.setItem('doneList', JSON.stringify(doneList));
    }
    function flagFunction() {
        if (subjectiveAnswers.includes(currentQuestion)) {
            var clickedBtn = document.getElementById('b' + (currentQuestion.toString()));
            clickedBtn.classList.remove("btn-light", "btn-outline-primary", "btn-dark");
            clickedBtn.classList.add("btn-warning");
            flagList[currentQuestion] = document.getElementById("fname").value
            doneList[currentQuestion] = document.getElementById("fname").value
        } else {
            var checkRadio = document.querySelector('input[name="fav_language"]:checked');
            if (checkRadio != null) {
                var clickedBtn = document.getElementById('b' + (currentQuestion.toString()));
                clickedBtn.classList.remove("btn-light", "btn-outline-primary", "btn-dark");
                clickedBtn.classList.add("btn-warning");
                flagList[currentQuestion] = checkRadio.id;
                doneList[currentQuestion] = checkRadio.id;
            }
        }
    }
    function clearAnswers() {
        console.log('clear answers')
        // document.querySelector('input[name="fav_language"]:checked').checked = false;
    }
function doneAnswers() {
console.log(doneList);
var ls = localStorage.getItem("doneList");
console.log('ls', ls)
var endSectionBtn = document.getElementById('endSectionBtn')
endSectionBtn.disabled = true;
if(ls === null){
<!--     localStorage.removeItem("doneList");-->
 location.replace("{% url 'index' %}")
} else{
saveAnswers()
}
function saveAnswers() {
var timeLeft = localStorage.getItem("timeLeft");
var selectedTest = localStorage.getItem("selectedTest");
var selectedTestId = localStorage.getItem("selectedTestId");
var url = "/endsection";
fetch(url, {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({'ls': ls, 'timeLeft':timeLeft, 'section':'math1',
  'user_id': user_id, 'selectedTest':selectedTest, 'selectedTestId':selectedTestId, 'testStatus':'m1'   }),
})
  .then((response) => {
    return response.json();
  })
  .then((data) => {
    console.log("response: ", data);
    if (data === "progress saved"){
<!--        alert('data sent success')-->
<!--localStorage.clear();-->
localStorage.removeItem("doneList");
localStorage.removeItem("timeLeft");
location.replace("{% url 'directionsm2' %}")
    }
  });
}
}
    btnFunction(1)
function doneBackup() {
console.log(doneList);
var ls = localStorage.getItem("doneList");
var timeLeft = localStorage.getItem("timeLeft");
var selectedTest = localStorage.getItem("selectedTest");
var selectedTestId = localStorage.getItem("selectedTestId");
var url = "/endsection";
fetch(url, {
method: "POST",
headers: {
  "Content-Type": "application/json",
},
  body: JSON.stringify({'ls': ls, 'timeLeft':timeLeft, 'section':'math1',
  'user_id': user_id, 'selectedTest':selectedTest, 'selectedTestId':selectedTestId, 'testStatus':'m1'   }),
})
.then((response) => {
  return response.json();
})
.then((data) => {
  console.log("response: ", data);
  if (data === "progress saved") {
    console.log("data saved");
  }
});
}
var elapsed = 0;
var x = setInterval(function () {
var ls = localStorage.getItem("doneList");
if(ls != null){
doneBackup();
}else {
console.log("backup empty")
elapsed += 60000;
console.log(elapsed);
if (elapsed > 3600000) {
clearInterval();
doneAnswers()
}
}
}, 60000);







</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>


<script>

        function fullscreen() {
            if ((document.fullScreenElement && document.fullScreenElement !== null) ||
                (!document.mozFullScreen && !document.webkitIsFullScreen)) {
                if (document.documentElement.requestFullScreen) {
                    document.documentElement.requestFullScreen();
                } else if (document.documentElement.mozRequestFullScreen) {
                    document.documentElement.mozRequestFullScreen();
                } else if (document.documentElement.webkitRequestFullScreen) {
                    document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
                }
            } else {
                if (document.cancelFullScreen) {
                    document.cancelFullScreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.webkitCancelFullScreen) {
                    document.webkitCancelFullScreen();
                }
            }
        }









</script>

<script src="https://www.desmos.com/api/v1.7/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>
<script>
  var elt = document.getElementById('calculatorx');
  var calculator = Desmos.GraphingCalculator(elt);
  calculator.setExpression({ id: 'graph1', latex: 'y=x^2' });


</script>


</body>

</html>